<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <title>IRON MAN - STARK OS v6</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Share Tech Mono', 'Courier New', monospace; }
        canvas { width: 100vw; height: 100vh; transform: scaleX(-1); }
        
        /* JARVIS HUD ARAYÃœZÃœ */
        #hud-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .panel { position: absolute; background: rgba(0, 50, 80, 0.4); border: 2px solid #0ff; color: #0ff; padding: 15px; box-shadow: 0 0 15px rgba(0, 255, 255, 0.5); border-radius: 5px; }
        #left-hud { top: 40px; left: 40px; border-left: 5px solid #0ff; }
        #right-hud { top: 40px; right: 40px; text-align: right; border-right: 5px solid #0ff; }
        #bottom-hud { bottom: 40px; left: 50%; transform: translateX(-50%); font-size: 24px; border-bottom: 3px solid #0ff; min-width: 300px; text-align: center; }
        
        .loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: #0ff; display: flex; align-items: center; justify-content: center; z-index: 9999; }
    </style>
</head>
<body>

    <div id="loading" class="loading-screen">SYSTEM BOOTING... JARVIS INITIALIZING...</div>

    <div id="hud-container">
        <div id="left-hud" class="panel">
            <div style="font-size: 10px; opacity: 0.7;">BIOMETRIC SCANNER</div>
            <div id="age-ui">AGE: CALCULATING...</div>
            <div id="bal-ui">STABILITY: SCANNING</div>
        </div>
        
        <div id="right-hud" class="panel">
            <div>POWER: 100%</div>
            <div id="status-ui">SYSTEM: ONLINE</div>
        </div>

        <div id="bottom-hud" class="panel">STANDBY MODE</div>
    </div>

    <canvas id="out"></canvas>
    <video id="vid" style="display:none" playsinline></video>

    <script>
        const video = document.getElementById('vid');
        const canvas = document.getElementById('out');
        const ctx = canvas.getContext('2d');
        const loading = document.getElementById('loading');

        // Hata korumalÄ± onResults fonksiyonu
        function onResults(res) {
            if (loading) loading.style.display = 'none'; // Ä°lk veri gelince yÃ¼kleme ekranÄ±nÄ± kaldÄ±r
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            ctx.save();
            // Iron Man GÃ¶rsel Filtresi (KaranlÄ±kta bile net)
            ctx.filter = "brightness(1.2) contrast(1.3) saturate(0.9) hue-rotate(170deg)";
            ctx.drawImage(res.image, 0, 0, canvas.width, canvas.height);
            ctx.filter = "none";

            // VÃœCUT TAKÄ°BÄ° (Ã‡ubuk Adam + YaÅŸ + Denge)
            if (res.poseLandmarks) {
                try {
                    const sW = Math.hypot(res.poseLandmarks[11].x - res.poseLandmarks[12].x, res.poseLandmarks[11].y - res.poseLandmarks[12].y);
                    const bH = Math.hypot(res.poseLandmarks[0].x - res.poseLandmarks[28].x, res.poseLandmarks[0].y - res.poseLandmarks[28].y);
                    const age = Math.round((sW/bH) * 132 - 4);
                    if(age > 5) document.getElementById('age-ui').innerText = "USER_AGE: " + age;

                    const stability = Math.abs(res.poseLandmarks[23].x - res.poseLandmarks[27].x);
                    document.getElementById('bal-ui').innerText = "STABILITY: " + (stability < 0.15 ? "OPTIMAL" : "UNSTABLE");

                    drawConnectors(ctx, res.poseLandmarks, POSE_CONNECTIONS, {color: '#0ff', lineWidth: 2});
                } catch (e) { console.log("Pose error bypassed"); }
            }

            // EL HAREKETLERÄ° VE EFEKTLER
            if (res.rightHandLandmarks || res.leftHandLandmarks) {
                const hand = res.rightHandLandmarks || res.leftHandLandmarks;
                const cx = hand[9].x * canvas.width;
                const cy = hand[9].y * canvas.height;
                
                // Parmak Durum Analizi
                let f = [hand[4].x < hand[3].x ? 1 : 0];
                [8,12,16,20].forEach(t => f.push(hand[t].y < hand[t-2].y ? 1 : 0));
                const code = f.join('');

                ctx.shadowBlur = 25; ctx.shadowColor = "#0ff";

                if (code === "11111") { // ðŸ–ï¸ REPULSOR
                    document.getElementById('bottom-hud').innerText = "âš¡ REPULSOR ACTIVATED";
                    ctx.fillStyle = "white";
                    ctx.beginPath(); ctx.arc(cx, cy, 50, 0, 7); ctx.fill();
                    ctx.strokeStyle = "#0ff"; ctx.lineWidth = 8;
                    ctx.beginPath(); ctx.arc(cx, cy, 70 + (Math.sin(Date.now()/50)*10), 0, 7); ctx.stroke();
                } 
                else if (code === "01000") { // â˜ï¸ TARGETING
                    document.getElementById('bottom-hud').innerText = "ðŸŽ¯ TARGET LOCK";
                    const tx = hand[8].x * canvas.width; const ty = hand[8].y * canvas.height;
                    ctx.strokeStyle = "red"; ctx.lineWidth = 2; ctx.strokeRect(tx-40, ty-40, 80, 80);
                    ctx.beginPath(); ctx.moveTo(tx-60, ty); ctx.lineTo(tx+60, ty); ctx.stroke();
                }
                else if (code === "00000") { // âœŠ CHARGING
                    document.getElementById('bottom-hud').innerText = "ðŸ”¥ POWER CHARGE";
                    ctx.strokeStyle = "#f90";
                    ctx.beginPath(); ctx.arc(cx, cy, (Date.now()%600)/6, 0, 7); ctx.stroke();
                }
                else {
                    document.getElementById('bottom-hud').innerText = "ANALYZING...";
                }
                drawConnectors(ctx, hand, HAND_CONNECTIONS, {color: '#fff', lineWidth: 2});
            } else {
                document.getElementById('bottom-hud').innerText = "SEARCHING FOR USER...";
            }

            ctx.restore();
        }

        const holistic = new Holistic({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${file}`});
        holistic.setOptions({ modelComplexity: 0, smoothLandmarks: true, minDetectionConfidence: 0.5 });
        holistic.onResults(onResults);

        const camera = new Camera(video, {
            onFrame: async () => { await holistic.send({image: video}); },
            width: 1280, height: 720
        });
        camera.start().catch(err => {
            alert("Kamera baÅŸlatÄ±lamadÄ±! LÃ¼tfen izin verdiÄŸinizden emin olun.");
        });
    </script>
</body>
</html>
