<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', monospace; }
        canvas { width: 100vw; height: 100vh; transform: scaleX(-1); }
        #overlay { position: absolute; top: 20px; left: 20px; color: #00f0ff; z-index: 10; }
        .auth-status { font-size: 24px; padding: 10px; border: 2px solid; }
        .yes { color: #00ff00; border-color: #00ff00; }
        .no { color: #ff0000; border-color: #ff0000; }
    </style>
</head>
<body>
    <div id="overlay">
        <div id="status" class="auth-status no">ACCESS DENIED - UNKNOWN USER</div>
        <div id="info">Sistem: Yüz ve Vücut Taraması Aktif...</div>
    </div>
    <canvas id="out"></canvas>
    <video id="vid" style="display:none"></video>

    <script>
        const video = document.getElementById('vid');
        const canvas = document.getElementById('out');
        const ctx = canvas.getContext('2d');
        const statusDiv = document.getElementById('status');

        // GÜVENLİK AYARI: Buraya kendi yüz özelliklerini tanımlayacağız (şimdilik basit bir kontrol)
        let isAuthorized = false;

        function onResults(res) {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ctx.save();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(res.image, 0, 0, canvas.width, canvas.height);

            // 1. YÜZ KONTROLÜ (GÜVENLİK)
            if (res.faceLandmarks) {
                // Burada yüzün genişliği/yüksekliği gibi oranlarla "sen" olup olmadığını anlarız
                // Gerçek FaceID için daha fazla veri lazım ama biz efektleri "Yüz varken" açıyoruz
                isAuthorized = true; 
                statusDiv.innerText = "ACCESS GRANTED: UTKAN";
                statusDiv.className = "auth-status yes";
            } else {
                isAuthorized = false;
                statusDiv.innerText = "ACCESS DENIED - NO USER";
                statusDiv.className = "auth-status no";
            }

            // 2. EFEKTLER (SADECE SEN VARKEN ÇALIŞIR)
            if (isAuthorized) {
                // Vücut Çizgileri (Mavi Şimşek Efekti)
                if (res.poseLandmarks) {
                    drawConnectors(ctx, res.poseLandmarks, POSE_CONNECTIONS, {color: '#00f0ff', lineWidth: 2});
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = "#00f0ff";
                }

                // El Aurası (Kırmızı/Mavi)
                if (res.rightHandLandmarks) {
                    const hand = res.rightHandLandmarks[8];
                    const x = hand.x * canvas.width;
                    const y = hand.y * canvas.height;
                    
                    // Aura Halkası
                    ctx.beginPath();
                    ctx.arc(x, y, 60, 0, Math.PI * 2);
                    ctx.strokeStyle = "#ff0000";
                    ctx.lineWidth = 5;
                    ctx.stroke();
                }

                // Yüz Matrix Efekti
                if (res.faceLandmarks) {
                    drawConnectors(ctx, res.faceLandmarks, FACEMESH_TESSELATION, {color: '#00ff0033', lineWidth: 1});
                }
            } else {
                // Yetkisiz birisi gelirse ekranı boz (Glitch efekti gibi)
                ctx.fillStyle = "rgba(255, 0, 0, 0.2)";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            ctx.restore();
        }

        const holistic = new Holistic({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${f}`});
        holistic.setOptions({ modelComplexity: 1, smoothLandmarks: true, minDetectionConfidence: 0.5 });
        holistic.onResults(onResults);

        new Camera(video, {onFrame: async () => await holistic.send({image: video}), width: 1280, height: 720}).start();
    </script>
</body>
</html>
