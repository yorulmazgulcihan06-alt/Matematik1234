<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>STARK: GOD MODE HUD</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <style>
        /* Sƒ∞NEMATƒ∞K ARAY√úZ TASARIMI */
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', monospace; }
        canvas { display: block; width: 100vw; height: 100vh; transform: scaleX(-1); }
        
        /* EKRAN TARAMA √áƒ∞ZGƒ∞LERƒ∞ (SCANLINES) */
        .scanlines {
            position: fixed; left: 0; top: 0; width: 100%; height: 100%; pointer-events: none;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px; z-index: 10; opacity: 0.6;
        }

        /* HUD PANELLERƒ∞ */
        .hud-panel {
            position: absolute; border: 1px solid rgba(0, 255, 255, 0.5); 
            background: rgba(0, 20, 40, 0.6); color: #0ff; padding: 15px; 
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3); font-weight: bold;
            backdrop-filter: blur(5px);
        }
        #top-left { top: 30px; left: 30px; border-left: 5px solid #0ff; }
        #top-right { top: 30px; right: 30px; text-align: right; border-right: 5px solid #0ff; }
        #bottom-center { 
            bottom: 40px; left: 50%; transform: translateX(-50%); 
            font-size: 24px; letter-spacing: 5px; text-shadow: 0 0 10px #0ff;
            background: transparent; border: none; box-shadow: none;
        }

        /* Y√úKLENƒ∞YOR EKRANI */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000;
            display: flex; justify-content: center; align-items: center; color: #0ff; font-size: 20px; z-index: 9999;
        }
    </style>
</head>
<body>
    <div id="loader">SYSTEM INITIALIZING... / STARK_OS V.9.0</div>
    <div class="scanlines"></div>

    <div id="top-left" class="hud-panel">
        <div>BIO-SCAN: ACTIVE</div>
        <div id="age-disp">AGE: CALCULATING...</div>
        <div id="stab-disp">STABILITY: --</div>
    </div>

    <div id="top-right" class="hud-panel">
        <div>CPU: OPTIMAL</div>
        <div>SYS: CONNECTED</div>
    </div>

    <div id="bottom-center" class="hud-panel">STANDBY</div>

    <canvas id="output"></canvas>
    <video id="video" style="display:none" playsinline></video>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('output');
        const ctx = canvas.getContext('2d');
        const loader = document.getElementById('loader');
        
        let width = window.innerWidth;
        let height = window.innerHeight;

        // EFEKT DEƒûƒ∞≈ûKENLERƒ∞
        let particles = []; 
        let hue = 0;

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.onresize = resize;
        resize();

        // --- ANA √áƒ∞Zƒ∞M D√ñNG√úS√ú ---
        function onResults(results) {
            loader.style.display = 'none'; // Y√ºkleme bitince ekranƒ± a√ß
            
            ctx.save();
            ctx.clearRect(0, 0, width, height);

            // 1. GECE G√ñR√ú≈û√ú & Sƒ∞NEMATƒ∞K Fƒ∞LTRE
            ctx.drawImage(results.image, 0, 0, width, height);
            // G√∂r√ºnt√ºy√º hafif karartƒ±p mavi/ye≈üil yap (Gece G√∂r√º≈ü√º Hissi)
            ctx.fillStyle = "rgba(0, 20, 10, 0.4)";
            ctx.fillRect(0, 0, width, height);
            
            // 2. STICKMAN (Neon ƒ∞skelet)
            if (results.poseLandmarks) {
                drawConnectors(ctx, results.poseLandmarks, POSE_CONNECTIONS, {color: 'rgba(0, 255, 255, 0.4)', lineWidth: 2});
                
                // Ya≈ü ve Denge Hesabƒ± (Basitle≈ütirilmi≈ü ve Hatasƒ±z)
                const shoulders = Math.abs(results.poseLandmarks[11].x - results.poseLandmarks[12].x);
                const heightBody = Math.abs(results.poseLandmarks[0].y - results.poseLandmarks[28].y);
                const calcAge = Math.floor((shoulders / heightBody) * 120); 
                if(calcAge > 10) document.getElementById('age-disp').innerText = `EST. AGE: ${calcAge}`;
                
                const hipCenter = results.poseLandmarks[23].x;
                const footCenter = results.poseLandmarks[27].x;
                const stability = Math.abs(hipCenter - footCenter) < 0.1 ? "100% STABLE" : "MOTION DETECTED";
                document.getElementById('stab-disp').innerText = `STATUS: ${stability}`;
            }

            // 3. EL HAREKETLERƒ∞ VE EFEKTLER (B√úY√ú BURADA)
            let leftHand = results.leftHandLandmarks;
            let rightHand = results.rightHandLandmarks;
            let activeMode = "SCANNING...";

            // EƒûER ƒ∞Kƒ∞ EL DE VARSA -> PLEXUS AƒûI (Videonuzdaki gibi)
            if (leftHand && rightHand) {
                activeMode = "‚ö†Ô∏è PLEXUS LINK";
                drawPlexus(leftHand, rightHand);
            }
            
            // SAƒû EL EFEKTLERƒ∞
            if (rightHand) {
                const gesture = getGesture(rightHand);
                const x = rightHand[9].x * width; // Avu√ß merkezi
                const y = rightHand[9].y * height;

                if (gesture === "OPEN_PALM") { // - REPULSOR
                    activeMode = "üî• REPULSOR BLAST";
                    drawRepulsor(x, y);
                } 
                else if (gesture === "POINT") { // LAZER
                    activeMode = "üéØ TARGET LOCK";
                    drawLaser(rightHand[8]);
                }
                else if (gesture === "PEACE" || gesture === "L_SHAPE") { // - AURA
                    activeMode = "üîÆ AURA SYSTEM";
                    drawAura(rightHand[8].x * width, rightHand[8].y * height);
                }

                // El iskeletini √ßiz
                drawConnectors(ctx, rightHand, HAND_CONNECTIONS, {color: '#0ff', lineWidth: 1});
                drawLandmarks(ctx, rightHand, {color: '#fff', radius: 2});
            }

            if(leftHand && !rightHand) {
                 drawConnectors(ctx, leftHand, HAND_CONNECTIONS, {color: '#0ff', lineWidth: 1});
            }

            document.getElementById('bottom-center').innerText = activeMode;
            ctx.restore();
        }

        // --- HAREKET ALGILAMA MOTORU ---
        function getGesture(landmarks) {
            // Parmak u√ßlarƒ± ve boƒüum kƒ±yaslamasƒ± (Basit Matematik)
            const isThumbOpen = landmarks[4].x < landmarks[3].x; // Basit saƒü el kontrol√º
            const isIndexOpen = landmarks[8].y < landmarks[6].y;
            const isMiddleOpen = landmarks[12].y < landmarks[10].y;
            const isRingOpen = landmarks[16].y < landmarks[14].y;
            const isPinkyOpen = landmarks[20].y < landmarks[18].y;

            if (isIndexOpen && isMiddleOpen && isRingOpen && isPinkyOpen) return "OPEN_PALM";
            if (isIndexOpen && !isMiddleOpen && !isRingOpen && !isPinkyOpen) return "POINT";
            if (isIndexOpen && isMiddleOpen && !isRingOpen) return "PEACE";
            return "UNKNOWN";
        }

        // --- G√ñRSEL EFEKT FONKSƒ∞YONLARI ---

        // 1. REPULSOR (ENERJƒ∞ TOPU)
        function drawRepulsor(x, y) {
            const time = Date.now() / 200;
            ctx.shadowBlur = 50; ctx.shadowColor = "#0ff";
            
            // Merkez √áekirdek
            ctx.beginPath();
            ctx.arc(x, y, 30 + Math.sin(time * 10) * 5, 0, Math.PI * 2);
            ctx.fillStyle = "#fff"; ctx.fill();

            // ≈ûok Dalgalarƒ±
            ctx.strokeStyle = `hsl(${time * 50}, 100%, 50%)`;
            ctx.lineWidth = 5;
            for(let i=0; i<3; i++) {
                ctx.beginPath();
                ctx.arc(x, y, 60 + (i*40) + Math.sin(time)*20, 0, Math.PI*2);
                ctx.stroke();
            }
            
            // Rastgele Elektrik √áizgileri
            for(let i=0; i<10; i++) {
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(x + (Math.random()-0.5)*300, y + (Math.random()-0.5)*300);
                ctx.strokeStyle = "rgba(255, 255, 255, 0.5)"; ctx.lineWidth = 2; ctx.stroke();
            }
        }

        // 2. PLEXUS (Aƒû BAƒûLANTISI)
        function drawPlexus(hand1, hand2) {
            // ƒ∞ki elin parmak u√ßlarƒ± arasƒ±ndaki mesafeyi √∂l√ß√ºp √ßizgi √ßekiyoruz
            const points1 = [4, 8, 12, 16, 20].map(i => hand1[i]);
            const points2 = [4, 8, 12, 16, 20].map(i => hand2[i]);

            ctx.lineWidth = 2;
            ctx.strokeStyle = "rgba(0, 255, 255, 0.6)";
            ctx.shadowBlur = 10; ctx.shadowColor = "#0ff";

            points1.forEach(p1 => {
                points2.forEach(p2 => {
                    // Mesafe hesabƒ±
                    const dist = Math.hypot(p1.x - p2.x, p1.y - p2.y);
                    if (dist < 0.4) { // Eƒüer yakƒ±nlarsa baƒüla
                        ctx.beginPath();
                        ctx.moveTo(p1.x * width, p1.y * height);
                        ctx.lineTo(p2.x * width, p2.y * height);
                        ctx.stroke();
                    }
                });
            });
        }

        // 3. AURA (RADAR)
        function drawAura(x, y) {
            const time = Date.now() / 1000;
            ctx.strokeStyle = "rgba(255, 200, 50, 0.8)";
            ctx.lineWidth = 2;
            
            // D√∂nen halkalar
            for(let i=1; i<5; i++) {
                ctx.beginPath();
                ctx.arc(x, y, i * 30, time * i, time * i + Math.PI * 1.5);
                ctx.stroke();
            }
            // Rakamlar (Hologram verisi gibi)
            ctx.fillStyle = "#0ff"; ctx.font = "12px Courier";
            ctx.fillText(`SEC: ${Math.floor(time)}`, x + 50, y - 50);
            ctx.fillText(`AXIS: ${Math.floor(x)}`, x + 50, y - 30);
        }

        // 4. LASER
        function drawLaser(tip) {
            ctx.beginPath();
            ctx.moveTo(tip.x * width, tip.y * height);
            ctx.lineTo(tip.x * width, 0); // Yukarƒ± fƒ±rlat
            ctx.strokeStyle = "#f00"; ctx.lineWidth = 4; ctx.shadowColor="red"; ctx.shadowBlur=20; 
            ctx.stroke();
        }

        // --- Sƒ∞STEM BA≈ûLATMA ---
        const holistic = new Holistic({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${file}`});
        holistic.setOptions({
            modelComplexity: 1, // Kaliteyi artƒ±rƒ±r
            smoothLandmarks: true,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });
        holistic.onResults(onResults);

        const camera = new Camera(video, {
            onFrame: async () => { await holistic.send({image: video}); },
            width: 1280,
            height: 720
        });
        camera.start();
    </script>
</body>
</html>
