<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NEXUS INFINITY | UTKAN'IN D√úNYASI</title>
    <style>
        :root { --neon: #00f2ff; --gold: #ffca2c; --danger: #ff4757; --glass: rgba(255,255,255,0.1); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; user-select: none; }
        body { background: #000; color: white; overflow: hidden; position: fixed; width: 100%; height: 100%; }

        /* --- Dƒ∞NAMƒ∞K ARKA PLANLAR --- */
        #game-stage { 
            width: 100vw; height: 100vh; transition: 1s filter, 1s background-image;
            background-size: cover; background-position: center; position: relative;
        }

        /* --- KARAKTER (MODERN TASARIM) --- */
        #player { 
            width: 50px; height: 80px; position: absolute; z-index: 1000;
            display: flex; flex-direction: column; align-items: center;
        }
        .char-body { width: 30px; height: 50px; background: var(--neon); border-radius: 10px; border: 3px solid #fff; box-shadow: 0 0 20px var(--neon); }
        .char-head { width: 25px; height: 25px; background: #ffe0bd; border-radius: 50%; margin-bottom: -5px; z-index: 2; }

        /* --- NPC TASARIMLARI --- */
        .npc { position: absolute; display: flex; flex-direction: column; align-items: center; transition: 0.5s; }
        .npc img { height: 120px; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5)); }
        .npc-label { background: var(--glass); backdrop-filter: blur(5px); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; margin-bottom: 5px; border: 1px solid rgba(255,255,255,0.2); }

        /* --- KONTROLLER (ULTRA MODERN) --- */
        #joystick-area { position: absolute; bottom: 40px; left: 40px; width: 140px; height: 140px; background: var(--glass); border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(5px); }
        #joystick-knob { position: absolute; top: 45px; left: 45px; width: 50px; height: 50px; background: #fff; border-radius: 50%; box-shadow: 0 0 30px var(--neon); }
        
        #action-btn { 
            position: fixed; bottom: 40px; right: 40px; width: 100px; height: 100px; 
            background: linear-gradient(45deg, var(--gold), #ff9f43); border-radius: 50%; 
            border: 4px solid #fff; color: #000; font-weight: 900; display: none; 
            align-items: center; justify-content: center; z-index: 2000; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* --- SOHBET ARAY√úZ√ú (WHATSAPP TARZI) --- */
        #chat-ui { 
            position: fixed; bottom: -100%; left: 0; width: 100%; height: 50%; 
            background: rgba(15,15,15,0.95); border-top: 3px solid var(--neon); 
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 5000; padding: 25px;
            border-radius: 30px 30px 0 0; backdrop-filter: blur(10px);
        }
        #chat-ui.active { bottom: 0; }
        .chat-bubble { background: var(--glass); padding: 15px; border-radius: 15px; margin-bottom: 20px; font-size: 1.1rem; line-height: 1.5; }
        .choice-btn { width: 100%; padding: 15px; background: var(--neon); color: #000; border: none; border-radius: 12px; font-weight: bold; margin-bottom: 10px; cursor: pointer; }
        .exit-btn { background: var(--danger); color: white; }

        /* --- HUD --- */
        #hud { position: fixed; top: 20px; left: 20px; display: flex; gap: 15px; z-index: 1000; }
        .stat { background: var(--glass); padding: 10px 20px; border-radius: 15px; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.1); font-weight: bold; }
    </style>
</head>
<body>

<div id="hud">
    <div class="stat" id="location-text">üìç EV</div>
    <div class="stat" id="time-text">‚è∞ 08:00</div>
</div>

<div id="game-stage">
    <div id="player">
        <div class="char-head"></div>
        <div class="char-body"></div>
    </div>

    <div id="objects-layer"></div>

    <div id="joystick-area"><div id="joystick-knob"></div></div>
    <div id="action-btn" onclick="Game.handleAction()">ETKƒ∞LE≈ûƒ∞M</div>
</div>

<div id="chat-ui">
    <h3 id="chat-name" style="color: var(--gold); margin-bottom: 10px;">ƒ∞Sƒ∞M</h3>
    <div class="chat-bubble" id="chat-text">...</div>
    <div id="chat-options"></div>
    <button class="choice-btn exit-btn" onclick="Game.closeChat()">SOHBETTEN √áIK</button>
</div>

<script>
const Game = {
    x: 100, y: 100, jx: 0, jy: 0,
    scene: 'HOME',
    contact: null,

    config: {
        HOME: {
            bg: 'https://images.unsplash.com/photo-1513694203232-719a280e022f?w=1200',
            name: 'üìç EV',
            npcs: [
                { id:'abla', name:'Abla', x:300, y:200, img:'https://cdn-icons-png.flaticon.com/512/3429/3429433.png', chat:'Utkan, ge√ß kalƒ±yorsun! Mustafa kapƒ±da seni bekliyor.' },
                { id:'door', name:'OKULA Gƒ∞T', x:700, y:400, img:'https://cdn-icons-png.flaticon.com/512/59/59801.png', portal:'SCHOOL' }
            ]
        },
        SCHOOL: {
            bg: 'https://images.unsplash.com/photo-1509062522246-3755977927d7?w=1200',
            name: 'üìç OKUL KORƒ∞DORU',
            npcs: [
                { id:'mustafa', name:'Mustafa', x:200, y:350, img:'https://cdn-icons-png.flaticon.com/512/3429/3429435.png', chat:'Selam kanka! Murat Hoca i√ßeride co≈ümu≈ü yine. Ka√ßalƒ±m mƒ± kantine?' },
                { id:'arkin', name:'Arkƒ±n', x:500, y:400, img:'https://cdn-icons-png.flaticon.com/512/3429/3429440.png', chat:'Utkan, √∂devi yaptƒ±n mƒ±? Gel k√ºt√ºphanede bir bakalƒ±m.' },
                { id:'class', name:'DERSE Gƒ∞R', x:800, y:200, img:'https://cdn-icons-png.flaticon.com/512/167/167707.png', portal:'CLASSROOM' }
            ]
        },
        CLASSROOM: {
            bg: 'https://images.unsplash.com/photo-1509062522246-3755977927d7?w=1200',
            name: 'üìç MATEMATƒ∞K SINIFI',
            npcs: [
                { id:'murat', name:'Murat Hoca', x:400, y:150, img:'https://www.pngarts.com/files/1/Cartoon-Teacher-Transparent-Background-PNG.png', quiz:true },
                { id:'exit', name:'SINIFTAN KA√á', x:50, y:450, img:'https://cdn-icons-png.flaticon.com/512/59/59801.png', portal:'SCHOOL' }
            ]
        }
    },

    init() {
        this.loadScene('HOME');
        this.initControls();
        this.loop();
    },

    loadScene(s) {
        this.scene = s;
        const data = this.config[s];
        const stage = document.getElementById('game-stage');
        const layer = document.getElementById('objects-layer');
        const locTxt = document.getElementById('location-text');

        stage.style.backgroundImage = `url('${data.bg}')`;
        locTxt.innerText = data.name;
        layer.innerHTML = '';

        data.npcs.forEach(n => {
            layer.innerHTML += `
                <div class="npc" id="npc-${n.id}" style="left:${n.x}px; top:${n.y}px">
                    <div class="npc-label">${n.name}</div>
                    <img src="${n.img}">
                </div>`;
        });
        this.x = 100; this.y = 400;
    },

    loop() {
        this.x += this.jx * 8; this.y += this.jy * 8;
        this.x = Math.max(20, Math.min(window.innerWidth-50, this.x));
        this.y = Math.max(window.innerHeight*0.3, Math.min(window.innerHeight-80, this.y));

        const p = document.getElementById('player');
        p.style.left = this.x + 'px'; p.style.top = this.y + 'px';
        if(this.jx !== 0) p.style.transform = `scaleX(${this.jx > 0 ? 1 : -1})`;

        this.checkProximity();
        requestAnimationFrame(() => this.loop());
    },

    checkProximity() {
        const npcs = this.config[this.scene].npcs;
        let found = null;
        npcs.forEach(n => {
            const d = Math.hypot(this.x - n.x, this.y - n.y);
            if(d < 100) found = n;
        });
        this.contact = found;
        document.getElementById('action-btn').style.display = found ? 'flex' : 'none';
    },

    handleAction() {
        const n = this.contact;
        if(n.portal) { this.loadScene(n.portal); return; }

        const ui = document.getElementById('chat-ui');
        const options = document.getElementById('chat-options');
        ui.classList.add('active');
        document.getElementById('chat-name').innerText = n.name;
        document.getElementById('chat-text').innerText = n.chat || "Selam Utkan, ne haber?";
        
        options.innerHTML = '';
        if(n.id === 'mustafa') {
            options.innerHTML += `<button class="choice-btn" onclick="alert('Mustafa: Tamam kanka, hoca bakmazken ka√ßƒ±yoruz!')">Hadi Kantine Ka√ßalƒ±m</button>`;
        }
        if(n.quiz) {
            document.getElementById('chat-text').innerText = "Murat Hoca: Utkan! 5.000 / 50 ka√ßtƒ±r? √áabuk cevap ver!";
            options.innerHTML += `<button class="choice-btn" onclick="alert('Aferin doƒüru cevap!')">100</button>`;
            options.innerHTML += `<button class="choice-btn" onclick="alert('Yanlƒ±≈ü! S√∂zl√ºye 0!')">10</button>`;
        }
    },

    closeChat() { document.getElementById('chat-ui').classList.remove('active'); },

    initControls() {
        const b = document.getElementById('joystick-area'), k = document.getElementById('joystick-knob');
        let act = false;
        const move = (e) => {
            if(!act) return;
            const t = e.touches ? e.touches[0] : e;
            const r = b.getBoundingClientRect();
            let dx = t.clientX - (r.left + 70), dy = t.clientY - (r.top + 70);
            const d = Math.sqrt(dx*dx + dy*dy);
            if(d > 50) { dx *= 50/d; dy *= 50/d; }
            k.style.transform = `translate(${dx}px, ${dy}px)`;
            this.jx = dx/50; this.jy = dy/50;
        };
        b.onmousedown = b.ontouchstart = () => act = true;
        window.onmousemove = window.ontouchmove = move;
        window.onmouseup = window.ontouchend = () => { act = false; k.style.transform = ''; this.jx=0; this.jy=0; };
    }
};

window.onload = () => Game.init();
</script>
</body>
</html>
