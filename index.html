<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; }
        canvas { width: 100vw; height: 100vh; transform: scaleX(-1); }
        #ui { position: absolute; top: 10px; left: 10px; color: #00ff00; font-family: sans-serif; background: rgba(0,0,0,0.5); padding: 10px; }
    </style>
</head>
<body>
    <div id="ui">SYSTEM: <span id="auth">OFFLINE</span></div>
    <canvas id="out"></canvas>
    <video id="vid" style="display:none"></video>

    <script>
        const video = document.getElementById('vid');
        const canvas = document.getElementById('out');
        const ctx = canvas.getContext('2d');

        function onResults(res) {
            // FPS artırmak için çözünürlüğü sabitliyoruz
            canvas.width = 640; 
            canvas.height = 480;
            
            ctx.save();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(res.image, 0, 0, canvas.width, canvas.height);

            // GÜVENLİK KONTROLÜ
            if (res.faceLandmarks) {
                document.getElementById('auth').innerText = "UTKAN DETECTED";
                document.getElementById('auth').style.color = "#00ff00";

                // VÜCUT (Sadece ana çizgiler - Kasmaması için)
                if (res.poseLandmarks) {
                    ctx.strokeStyle = "#00f0ff";
                    ctx.lineWidth = 2;
                    // Omuzlar arası şimşek çizgisi gibi basit çizim
                    ctx.beginPath();
                    ctx.moveTo(res.poseLandmarks[11].x * 640, res.poseLandmarks[11].y * 480);
                    ctx.lineTo(res.poseLandmarks[12].x * 640, res.poseLandmarks[12].y * 480);
                    ctx.stroke();
                }

                // EL (Sadece parmak ucu efekti)
                if (res.rightHandLandmarks) {
                    const tip = res.rightHandLandmarks[8];
                    ctx.fillStyle = "#ff0000";
                    ctx.beginPath();
                    ctx.arc(tip.x * 640, tip.y * 480, 15, 0, Math.PI*2);
                    ctx.fill();
                }
            } else {
                document.getElementById('auth').innerText = "ACCESS DENIED";
                document.getElementById('auth').style.color = "#ff0000";
                // Birisi yoksa ekranı karart (FPS tasarrufu)
                ctx.fillStyle = "rgba(0,0,0,0.6)";
                ctx.fillRect(0,0,640,480);
            }
            ctx.restore();
        }

        const h = new Holistic({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${f}`});
        
        // --- TURBO AYARLAR ---
        h.setOptions({
            modelComplexity: 0, // 0 en hızlıdır, 1 orta, 2 en ağır
            smoothLandmarks: false, // Titremeyi önlemeyi kapat (hız için)
            minDetectionConfidence: 0.5
        });

        h.onResults(onResults);
        new Camera(video, {onFrame: async () => await h.send({image: video}), width: 640, height: 480}).start();
    </script>
</body>
</html>
