<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UTKAN-OS | NEURO-LINKED BIOMETRIC KERNEL v99.0</title>
    <style>
        /* =========================================
           CORE STYLESHEET - SYSTEM LEVEL
           ========================================= */
        :root {
            --primary: #00ff41;
            --secondary: #008F11;
            --alert: #ff0033;
            --warn: #ffcc00;
            --bg-dark: #020202;
            --panel-bg: rgba(10, 10, 10, 0.95);
            --grid-line: rgba(0, 255, 65, 0.1);
            --font-stack: 'Courier New', 'Consolas', monospace;
        }

        * { box-sizing: border-box; user-select: none; }
        
        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-dark);
            color: var(--primary);
            font-family: var(--font-stack);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* CRT EFFECT & SCANLINES */
        body::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 999;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* LAYOUT GRID */
        #main-interface {
            display: none; /* Hidden until boot */
            grid-template-columns: 300px 1fr 350px;
            grid-template-rows: 60px 1fr 200px;
            height: 100%;
            width: 100%;
            padding: 10px;
            gap: 5px;
        }

        /* HEADER */
        header {
            grid-column: 1 / -1;
            border: 1px solid var(--secondary);
            background: var(--panel-bg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 0 15px var(--grid-line);
        }

        .sys-badge { font-weight: bold; letter-spacing: 2px; border: 1px solid var(--primary); padding: 5px 10px; font-size: 0.8rem; }
        .sys-time { font-size: 0.9rem; color: #aaa; }

        /* PANELS */
        .panel {
            border: 1px solid #222;
            background: var(--panel-bg);
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .panel-header {
            background: #111;
            padding: 5px 10px;
            font-size: 0.7rem;
            border-bottom: 1px solid #333;
            color: #666;
            text-transform: uppercase;
            display: flex;
            justify-content: space-between;
        }

        /* METRIC CARDS */
        .metric-row {
            padding: 15px;
            border-bottom: 1px solid #1a1a1a;
            transition: 0.2s;
        }

        .metric-row:hover { background: rgba(0, 255, 65, 0.05); }

        .label { display: block; font-size: 0.7rem; color: #555; text-transform: uppercase; }
        .value { display: block; font-size: 1.8rem; margin-top: 5px; font-weight: bold; color: #ddd; }
        .unit { font-size: 0.8rem; margin-left: 5px; color: #444; }

        /* PULSE LED */
        .led-panel {
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-top: 1px solid #222;
        }

        #pulse-led {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #222;
            box-shadow: 0 0 5px #000;
            transition: 0.05s;
        }

        .led-active {
            background: var(--alert) !important;
            box-shadow: 0 0 20px var(--alert), 0 0 40px var(--alert) !important;
        }

        /* MAIN VISUALIZATION AREA (CANVAS) */
        #core-viz {
            background: #000;
            position: relative;
            overflow: hidden;
            border: 1px solid #222;
            cursor: crosshair;
        }

        canvas { display: block; }

        /* TERMINAL (CONSOLE) */
        #sys-log {
            grid-column: 1 / -1;
            background: #000;
            border: 1px solid #222;
            padding: 10px;
            font-family: 'Consolas', monospace;
            font-size: 0.75rem;
            color: var(--secondary);
            overflow-y: scroll;
            height: 100%;
        }

        .log-entry { margin-bottom: 3px; border-left: 2px solid #111; padding-left: 5px; }
        .log-warn { color: var(--warn); }
        .log-error { color: var(--alert); }

        /* BOOT SCREEN */
        #boot-screen {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: #000;
            color: var(--primary);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: monospace;
        }

        #boot-text { text-align: left; width: 600px; line-height: 1.5; font-size: 0.9rem; }
        .boot-bar { width: 600px; height: 5px; background: #222; margin-top: 20px; }
        .boot-fill { width: 0%; height: 100%; background: var(--primary); transition: width 0.1s; }

        /* BUTTONS */
        .btn-panel { display: flex; gap: 5px; padding: 10px; margin-top: auto; }
        .btn {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 15px;
            font-family: inherit;
            cursor: pointer;
            flex: 1;
            font-size: 0.7rem;
            transition: 0.2s;
        }
        .btn:hover { background: var(--primary); color: #000; }

        /* SPECTRUM ANALYZER */
        .spectrum-bar { height: 100px; display: flex; align-items: flex-end; gap: 1px; padding: 5px; background: #050505; }
        .spec-col { flex: 1; background: var(--secondary); min-height: 2px; transition: height 0.1s; }

        /* MODALS */
        .modal {
            position: fixed;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 2px solid var(--primary);
            padding: 30px;
            z-index: 2000;
            width: 500px;
            display: none;
            box-shadow: 0 0 50px rgba(0, 255, 65, 0.2);
        }
        .modal h2 { margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .modal p { font-size: 0.8rem; color: #aaa; line-height: 1.6; }

    </style>
</head>
<body>

<div id="boot-screen">
    <div id="boot-text">INITIALIZING BIOS KERNEL...</div>
    <div class="boot-bar"><div class="boot-fill" id="boot-prog"></div></div>
</div>

<div id="main-interface">
    <header>
        <div class="sys-badge">UTKAN-OS v99.0</div>
        <div class="sys-info">
            CPU: <span id="cpu-load">0%</span> | MEM: <span id="mem-load">0MB</span>
        </div>
        <div class="sys-time" id="clock-display">00:00:00</div>
    </header>

    <aside class="panel">
        <div class="panel-header"><span>Real-Time Biometrics</span><span>[SENS-01]</span></div>
        
        <div class="metric-row">
            <span class="label">Sampling Rate (Avg)</span>
            <span class="value" id="val-hz">0.00</span><span class="unit">Hz</span>
        </div>
        
        <div class="metric-row">
            <span class="label">Jitter Variance (σ)</span>
            <span class="value" id="val-jitter">0.00</span><span class="unit">ms</span>
        </div>
        
        <div class="metric-row">
            <span class="label">Neuro-Stability</span>
            <span class="value" id="val-stab">0.0</span><span class="unit">%</span>
        </div>

        <div class="led-panel">
            <div id="pulse-led"></div>
        </div>

        <div class="btn-panel">
            <button class="btn" onclick="Kernel.reset()">RESET_CORE</button>
            <button class="btn" onclick="Kernel.export()">DUMP_LOGS</button>
        </div>
    </aside>

    <section class="panel" id="core-viz">
        <div class="panel-header"><span>Oscilloscope Display</span><span>[GPU-ACCEL]</span></div>
        <canvas id="mainCanvas"></canvas>
    </section>

    <aside class="panel">
        <div class="panel-header"><span>Cognitive AI Engine</span><span>[BETA]</span></div>
        
        <div style="padding: 15px; flex: 1; overflow-y: auto;">
            <div style="font-size: 0.7rem; color: #888; margin-bottom: 5px;">AI DIAGNOSIS:</div>
            <div id="ai-output" style="font-size: 0.85rem; line-height: 1.4; color: #fff;">
                Waiting for sufficient biometric data (N > 10)...
            </div>
        </div>

        <div class="panel-header"><span>Frequency Spectrum</span></div>
        <div class="spectrum-bar" id="spec-viz">
            </div>

        <div style="padding: 10px; font-size: 0.65rem; color: #555; text-align: center;">
            PRESS [SPACE] OR CLICK TO INJECT PULSE SIGNAL
        </div>
    </aside>

    <footer class="panel" style="grid-column: 1 / -1;">
        <div class="panel-header"><span>System Kernel Logs</span><span>[TERMINAL]</span></div>
        <div id="sys-log"></div>
    </footer>
</div>

<div id="report-modal" class="modal">
    <h2>SESSION REPORT GENERATED</h2>
    <p>Biometric session data has been compiled into a localized JSON object.</p>
    <div style="background: #111; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 0.7rem;" id="modal-content"></div>
    <button class="btn" onclick="document.getElementById('report-modal').style.display='none'">CLOSE_WINDOW</button>
</div>

<script>
/**
 * UTKAN-OS NEURO-LINKED KERNEL
 * ARCHITECTURE: MONOLITHIC CLASS-BASED SYSTEM
 * AUTHOR: GEMINI AI | FOR USER: UTKAN
 * BUILD: 2026.02.19_v99
 */

/* =========================================
   MODULE 1: UTILITIES & MATH LIBRARY
   ========================================= */
const MathLib = {
    avg: (arr) => arr.reduce((a, b) => a + b, 0) / arr.length,
    
    stdDev: (arr) => {
        if (arr.length < 2) return 0;
        const mean = MathLib.avg(arr);
        const variance = arr.reduce((acc, val) => acc + Math.pow(val - mean, 2), 0) / arr.length;
        return Math.sqrt(variance);
    },

    map: (val, inMin, inMax, outMin, outMax) => {
        return (val - inMin) * (outMax - outMin) / (inMax - inMin) + outMin;
    },

    formatTime: () => {
        const d = new Date();
        return d.toLocaleTimeString('tr-TR', { hour12: false });
    },

    generateId: () => {
        return Math.random().toString(36).substr(2, 9);
    }
};

/* =========================================
   MODULE 2: AUDIO SYNTHESIZER (WEB AUDIO API)
   ========================================= */
class AudioEngine {
    constructor() {
        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        this.masterGain = this.ctx.createGain();
        this.masterGain.gain.value = 0.1; // Low volume safety
        this.masterGain.connect(this.ctx.destination);
    }

    playTone(freq, type = 'sine', duration = 0.1) {
        if (this.ctx.state === 'suspended') this.ctx.resume();
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        
        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        
        gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + duration);
        
        osc.connect(gain);
        gain.connect(this.masterGain);
        
        osc.start();
        osc.stop(this.ctx.currentTime + duration);
    }

    playAlert() {
        this.playTone(880, 'square', 0.2);
        setTimeout(() => this.playTone(440, 'square', 0.4), 200);
    }
}

/* =========================================
   MODULE 3: VISUALIZATION ENGINE (CANVAS)
   ========================================= */
class RenderEngine {
    constructor(canvasId) {
        this.canvas = document.getElementById(canvasId);
        this.ctx = this.canvas.getContext('2d');
        this.width = this.canvas.offsetWidth;
        this.height = this.canvas.offsetHeight;
        this.particles = [];
        this.waveData = [];
        
        window.addEventListener('resize', () => this.resize());
        this.resize();
        this.animate();
    }

    resize() {
        this.width = this.canvas.parentElement.offsetWidth;
        this.height = this.canvas.parentElement.offsetHeight;
        this.canvas.width = this.width;
        this.canvas.height = this.height;
    }

    addPulse(x, intensity) {
        for(let i=0; i<10; i++) {
            this.particles.push({
                x: x,
                y: this.height / 2,
                vx: (Math.random() - 0.5) * 5,
                vy: (Math.random() - 0.5) * 5,
                life: 1.0,
                color: intensity > 100 ? '#ff0033' : '#00ff41'
            });
        }
    }

    updateWave(data) {
        this.waveData = data;
    }

    animate() {
        const { ctx, width, height } = this;
        
        // Clear with trails
        ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
        ctx.fillRect(0, 0, width, height);

        // Grid Background
        ctx.strokeStyle = '#111';
        ctx.lineWidth = 1;
        ctx.beginPath();
        for(let i=0; i<width; i+=50) { ctx.moveTo(i,0); ctx.lineTo(i,height); }
        for(let i=0; i<height; i+=50) { ctx.moveTo(0,i); ctx.lineTo(width,i); }
        ctx.stroke();

        // Draw Waveform
        if (this.waveData.length > 1) {
            ctx.beginPath();
            ctx.strokeStyle = '#00ff41';
            ctx.lineWidth = 2;
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#00ff41';
            
            const step = width / 100; // Show last 100 points
            const startIdx = Math.max(0, this.waveData.length - 100);
            
            for (let i = startIdx; i < this.waveData.length; i++) {
                const x = (i - startIdx) * step;
                // Normalize value for display (assuming range 0-1000ms)
                const y = height - MathLib.map(this.waveData[i], 0, 1000, 10, height - 10);
                if (i === startIdx) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            ctx.shadowBlur = 0;
        }

        // Update Particles
        for (let i = this.particles.length - 1; i >= 0; i--) {
            let p = this.particles[i];
            p.x += p.vx;
            p.y += p.vy;
            p.life -= 0.02;
            
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life;
            ctx.beginPath();
            ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
            ctx.fill();
            
            if (p.life <= 0) this.particles.splice(i, 1);
        }
        ctx.globalAlpha = 1;

        // Center Line
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
        ctx.beginPath();
        ctx.moveTo(0, height/2);
        ctx.lineTo(width, height/2);
        ctx.stroke();

        requestAnimationFrame(() => this.animate());
    }
}

/* =========================================
   MODULE 4: SYSTEM KERNEL (MAIN LOGIC)
   ========================================= */
class SystemKernel {
    constructor() {
        this.state = {
            timestamps: [],
            intervals: [],
            isReady: false,
            metrics: {
                hz: 0,
                jitter: 0,
                stability: 0
            }
        };
        
        this.config = {
            bufferSize: 100,
            debounce: 80, // ms
            noiseThreshold: 2000 // ms
        };

        this.audio = new AudioEngine();
        this.logger = document.getElementById('sys-log');
        this.viz = null; // Initialized after boot
        this.ui = {}; // Cached DOM elements
    }

    // BOOT SEQUENCE SIMULATION
    boot() {
        const bootText = document.getElementById('boot-text');
        const bootProg = document.getElementById('boot-prog');
        const bootScreen = document.getElementById('boot-screen');
        const mainInterface = document.getElementById('main-interface');
        
        let progress = 0;
        const logs = [
            "Mounting file system...",
            "Loading biometric drivers...",
            "Initializing DSP engine...",
            "Connecting to neural interface...",
            "Calibrating sensors...",
            "System check: OK",
            "Starting UTKAN-OS kernel..."
        ];

        const interval = setInterval(() => {
            progress += Math.random() * 10;
            if (progress > 100) progress = 100;
            bootProg.style.width = `${progress}%`;
            
            if (Math.random() > 0.7) {
                const log = logs.shift();
                if (log) bootText.innerHTML += `<br>> ${log}`;
            }

            if (progress === 100) {
                clearInterval(interval);
                setTimeout(() => {
                    bootScreen.style.display = 'none';
                    mainInterface.style.display = 'grid'; // Grid layout activated
                    this.init();
                }, 500);
            }
        }, 100);
    }

    // INITIALIZATION
    init() {
        this.log("KERNEL_LOADED successfully.");
        this.viz = new RenderEngine('mainCanvas');
        this.cacheDOM();
        this.bindEvents();
        this.startClock();
        this.generateSpectrumBars();
        this.log("Listening for input signals...");
    }

    cacheDOM() {
        this.ui = {
            hz: document.getElementById('val-hz'),
            jitter: document.getElementById('val-jitter'),
            stab: document.getElementById('val-stab'),
            ai: document.getElementById('ai-output'),
            led: document.getElementById('pulse-led'),
            cpu: document.getElementById('cpu-load'),
            mem: document.getElementById('mem-load')
        };
    }

    bindEvents() {
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.key === 'j') {
                this.handleInput();
            }
        });
        
        document.getElementById('core-viz').addEventListener('mousedown', () => {
            this.handleInput();
        });
    }

    // CORE LOGIC: INPUT HANDLING
    handleInput() {
        const now = performance.now();
        this.flashLed();
        this.audio.playTone(600, 'sine', 0.05);

        // Particle effect at center
        if (this.viz) this.viz.addPulse(this.viz.width / 2, 50);

        if (this.state.timestamps.length > 0) {
            const lastTime = this.state.timestamps[this.state.timestamps.length - 1];
            const diff = now - lastTime;

            // Filters
            if (diff < this.config.debounce) return; // Debounce
            if (diff > this.config.noiseThreshold) {
                this.log(`Signal reset: Time gap too large (${diff.toFixed(0)}ms)`, 'warn');
                this.state.timestamps = [now]; // Reset chain
                return;
            }

            this.processSignal(diff);
        }
        
        this.state.timestamps.push(now);
        if (this.state.timestamps.length > this.config.bufferSize) this.state.timestamps.shift();
    }

    processSignal(diff) {
        this.state.intervals.push(diff);
        if (this.state.intervals.length > this.config.bufferSize) this.state.intervals.shift();

        // Pass data to visualizer
        this.viz.updateWave(this.state.intervals);

        // CALCULATE METRICS
        const avg = MathLib.avg(this.state.intervals);
        const sigma = MathLib.stdDev(this.state.intervals);
        
        // Hz Calculation (1000ms / avg ms)
        const hz = (1000 / avg);
        
        // Stability Calculation (Lower sigma is better)
        // Heuristic: If sigma is 10% of avg, stability is 0. If sigma is 0, stability is 100.
        const cv = sigma / avg; // Coefficient of Variation
        let stability = 100 - (cv * 1000); 
        stability = Math.max(0, Math.min(100, stability));

        // UPDATE STATE
        this.state.metrics = { hz, jitter: sigma, stability };
        
        // UPDATE UI
        this.updateUI();
        this.updateAI(sigma, stability);
        this.animateSpectrum(diff);

        // LOG
        this.log(`IMPULSE: ${diff.toFixed(1)}ms | σ: ${sigma.toFixed(2)}`, sigma > 50 ? 'warn' : 'info');
    }

    updateUI() {
        const { hz, jitter, stability } = this.state.metrics;
        
        this.ui.hz.innerText = hz.toFixed(2);
        this.ui.jitter.innerText = jitter.toFixed(2);
        this.ui.stab.innerText = stability.toFixed(1);
        
        // Dynamic Color Changes
        this.ui.stab.style.color = stability > 80 ? 'var(--primary)' : (stability > 50 ? 'var(--warn)' : 'var(--alert)');
    }

    updateAI(sigma, stability) {
        if (this.state.intervals.length < 10) return;

        let diagnosis = "";
        let color = "#fff";

        if (stability > 90) {
            diagnosis = "OPTIMAL SYNCHRONIZATION DETECTED. Subject is in 'Flow State'. Motor cortex activity is highly rhythmic.";
            color = "var(--primary)";
        } else if (stability > 70) {
            diagnosis = "NORMAL OPERATION. Minor variances detected within acceptable cognitive load limits.";
            color = "#ccc";
        } else if (stability > 40) {
            diagnosis = "IRREGULAR PATTERN DETECTED. Possible cognitive fatigue or distraction. Variance exceeds safety thresholds.";
            color = "var(--warn)";
        } else {
            diagnosis = "CRITICAL INSTABILITY. Neuro-motor feedback loop is compromised. Immediate recalibration required.";
            color = "var(--alert)";
            if (Math.random() > 0.9) this.audio.playAlert();
        }

        this.ui.ai.innerHTML = diagnosis;
        this.ui.ai.style.color = color;
    }

    // VISUAL: FLASH LED
    flashLed() {
        this.ui.led.classList.add('led-active');
        setTimeout(() => this.ui.led.classList.remove('led-active'), 50);
    }

    // VISUAL: SPECTRUM BARS
    generateSpectrumBars() {
        const container = document.getElementById('spec-viz');
        for (let i = 0; i < 20; i++) {
            const bar = document.createElement('div');
            bar.className = 'spec-col';
            bar.id = `spec-${i}`;
            container.appendChild(bar);
        }
    }

    animateSpectrum(val) {
        // Simulate frequency spectrum based on input value
        for(let i=0; i<20; i++) {
            const bar = document.getElementById(`spec-${i}`);
            const h = Math.random() * 100;
            bar.style.height = `${h}%`;
            bar.style.backgroundColor = h > 80 ? 'var(--primary)' : 'var(--secondary)';
        }
    }

    // SYSTEM UTILS
    log(msg, type = 'info') {
        const entry = document.createElement('div');
        entry.className = `log-entry ${type === 'warn' ? 'log-warn' : ''} ${type === 'error' ? 'log-error' : ''}`;
        entry.innerText = `[${MathLib.formatTime()}] ${msg}`;
        this.logger.prepend(entry);
        if (this.logger.children.length > 50) this.logger.lastChild.remove();
    }

    startClock() {
        setInterval(() => {
            document.getElementById('clock-display').innerText = MathLib.formatTime();
            // Simulate CPU/Mem load
            this.ui.cpu.innerText = (Math.random() * 15).toFixed(1) + "%";
            this.ui.mem.innerText = Math.floor(200 + Math.random() * 50) + "MB";
        }, 1000);
    }

    reset() {
        this.state.intervals = [];
        this.state.timestamps = [];
        this.state.metrics = { hz: 0, jitter: 0, stability: 0 };
        this.ui.hz.innerText = "0.00";
        this.ui.jitter.innerText = "0.00";
        this.ui.stab.innerText = "0.0";
        this.ui.ai.innerText = "System Reset. Awaiting input...";
        this.log("System manually reset via Kernel Override.", "warn");
    }

    export() {
        const modal = document.getElementById('report-modal');
        const content = document.getElementById('modal-content');
        
        const report = {
            sessionId: MathLib.generateId(),
            timestamp: new Date().toISOString(),
            totalPulses: this.state.intervals.length,
            metrics: this.state.metrics,
            rawData: this.state.intervals.slice(-10) // Last 10 samples
        };

        content.innerText = JSON.stringify(report, null, 2);
        modal.style.display = 'block';
        this.log("Data dumped to modal window.");
    }
}

// =========================================
// SYSTEM ENTRY POINT
// =========================================
const Kernel = new SystemKernel();

window.onload = () => {
    // Start the boot sequence
    Kernel.boot();
};

</script>
</body>
</html>
