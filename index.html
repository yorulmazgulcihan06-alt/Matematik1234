<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TITAN OVERDRIVE</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Share Tech Mono', monospace; color: #0f0; }
        canvas { position: absolute; width: 100vw; height: 100vh; transform: scaleX(-1); filter: contrast(1.2) brightness(1.1); }
        
        /* ÜST MOD SEÇİMİ */
        #top-nav {
            position: fixed; top: 0; width: 100%; display: flex; justify-content: space-around;
            background: rgba(0, 20, 0, 0.8); z-index: 20; border-bottom: 1px solid #0f0;
        }
        .mod-btn { padding: 10px; font-size: 10px; cursor: pointer; border: none; background: none; color: #0f0; opacity: 0.5; }
        .mod-btn.active { opacity: 1; border-bottom: 2px solid #0f0; }

        /* HUD VERİLERİ */
        .hud { position: fixed; z-index: 10; pointer-events: none; text-shadow: 0 0 5px #0f0; }
        .left-data { top: 50px; left: 10px; border-left: 2px solid #0f0; padding-left: 5px; font-size: 12px; }
        .right-data { top: 50px; right: 10px; text-align: right; border-right: 2px solid #0f0; padding-right: 5px; font-size: 12px; }

        /* GECE GÖRÜŞÜ FİLTRESİ */
        .nv-mode { filter: sepia(1) hue-rotate(90deg) saturate(4) brightness(0.8) !important; }
    </style>
</head>
<body>

    <div id="top-nav">
        <button class="mod-btn active" onclick="changeMode('combat', this)">COMBAT</button>
        <button class="mod-btn" onclick="changeMode('stealth', this)">STEALTH (NV)</button>
        <button class="mod-btn" onclick="changeMode('scan', this)">BIO-SCAN</button>
    </div>

    <div class="hud left-data">
        TARGET: <span id="target-id">ANALYZING...</span><br>
        EST. AGE: <span id="age">--</span><br>
        BALANCE: <span id="balance">0%</span>
    </div>

    <div class="hud right-data">
        SİSTEM: AKTİF<br>
        BAĞLANTI: ŞİFRELİ<br>
        FPS: <span id="fps">0</span>
    </div>

    <canvas id="canvas"></canvas>
    <video id="video" style="display:none" playsinline></video>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let mode = 'combat';

        function changeMode(m, btn) {
            mode = m;
            document.querySelectorAll('.mod-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            canvas.className = (m === 'stealth') ? 'nv-mode' : '';
        }

        const holistic = new Holistic({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${f}`});
        holistic.setOptions({ modelComplexity: 0, smoothLandmarks: true, minDetectionConfidence: 0.5 });

        let lastTime = 0;
        holistic.onResults((res) => {
            // FPS Hesabı
            const now = Date.now();
            document.getElementById('fps').innerText = Math.round(1000 / (now - lastTime));
            lastTime = now;

            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            ctx.save();
            ctx.clearRect(0,0, canvas.width, canvas.height);
            ctx.drawImage(res.image, 0, 0, canvas.width, canvas.height);

            // 1. İSKELET TARAMA (POSE)
            if (res.poseLandmarks) {
                drawConnectors(ctx, res.poseLandmarks, POSE_CONNECTIONS, {color: '#0f0', lineWidth: 2});
                // Denge Analizi (Omuz ve kalça hizasından salla)
                const balance = Math.abs(res.poseLandmarks[11].y - res.poseLandmarks[12].y);
                document.getElementById('balance').innerText = (100 - (balance * 1000)).toFixed(1) + "%";
            }

            // 2. 20 EL HAREKETİ (HANDS)
            if (res.leftHandLandmarks) drawConnectors(ctx, res.leftHandLandmarks, HAND_CONNECTIONS, {color: '#fff', lineWidth: 1.5});
            if (res.rightHandLandmarks) drawConnectors(ctx, res.rightHandLandmarks, HAND_CONNECTIONS, {color: '#fff', lineWidth: 1.5});

            // 3. YAŞ TAHMİNİ (FACE - SİMÜLE)
            if (res.faceLandmarks) {
                document.getElementById('target-id').innerText = "HUMAN_MALE_01";
                // Yaş tahmini (Yüz genişliğine göre rastgele ama mantıklı bir sayı üretir)
                if(document.getElementById('age').innerText === "--") {
                    document.getElementById('age').innerText = Math.floor(Math.random() * 5 + 24); // Enişteye göre ayarla
                }
                drawConnectors(ctx, res.faceLandmarks, FACEMESH_TESSELATION, {color: '#0f03', lineWidth: 0.5});
            }

            ctx.restore();
        });

        const cam = new Camera(video, {
            onFrame: async () => { await holistic.send({image: video}); },
            width: 480, height: 360 // TURBO HIZ İÇİN DÜŞÜK ÇÖZÜNÜRLÜK
        });
        cam.start();
    </script>
</body>
</html>
