<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS V85 | Master Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        :root { --p: #3b82f6; --s: #10b981; --d: #080c14; --r: #ef4444; --b: #161b22; --y: #fbbf24; --tr: #da291c; }
        body { margin: 0; background: var(--d); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        .page { display: none; width: 100%; height: 100vh; padding: 20px; box-sizing: border-box; overflow-y: auto; padding-bottom: 100px; }
        .card { background: var(--b); padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #30363d; position: relative; }
        .btn { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; color: white; margin-top: 10px; background: var(--p); transition: 0.2s; }
        
        /* CANLI YAYIN MODU */
        #live-fullscreen { display: none; position: fixed; inset: 0; background: #000; z-index: 9999999; }
        #exit-live-btn { position: absolute; top: 0; width: 100%; height: 50px; background: var(--tr); color: white; border: none; font-weight: bold; cursor: pointer; z-index: 10000000; }

        /* HATA ONARIM (KARARTMA) */
        #repair-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9000000; cursor: crosshair; }
        .repair-glow { box-shadow: 0 0 20px var(--y) !important; border: 2px solid var(--y) !important; animation: pulse 0.8s infinite; z-index: 9000001 !important; position: relative !important; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* NAVÄ°GASYON */
        .nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: #0f172a; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #334155; }
        .nav-item { text-align: center; font-size: 10px; cursor: pointer; }

        /* SOHBET KUTUSU */
        #chat-messages { height: 200px; overflow-y: auto; background: #000; padding: 10px; border-radius: 10px; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>

    <div id="live-fullscreen">
        <button id="exit-live-btn" onclick="exitLive()">ğŸ”´ YAYINDAN Ã‡IK (ANA MENÃœYE DÃ–N)</button>
        <div style="display: flex; height: 100%; pt: 50px;">
            <div id="live-player" style="flex: 3; background: #000;"></div>
            <div id="live-bridge-chat" style="flex: 1; background: #0d1117; border-left: 2px solid var(--tr); padding-top: 50px; display: flex; flex-direction: column;">
                <div id="bridge-msgs" style="flex: 1; overflow-y: auto; padding: 10px;"></div>
                <input type="text" id="bridge-input" onkeypress="handleBridgeKey(event)" placeholder="Hocaya mesaj gÃ¶nder..." style="width: 100%; padding: 10px; background: #000; color: #fff; border: none; border-top: 1px solid var(--tr);">
            </div>
        </div>
    </div>

    <div id="repair-overlay" onclick="fixThisElement(event)">
        <div style="color: var(--y); text-align: center; margin-top: 20px;"><h1>âš¡ AI REPAIR MODE</h1><p>HatalÄ± butona dokun!</p></div>
    </div>

    <div id="login-screen" style="position:fixed; inset:0; background:var(--d); z-index:100; display:flex; align-items:center; justify-content:center;">
        <div class="card" style="width:300px; text-align:center;">
            <h2 style="color:var(--p);">NEXUS V85</h2>
            <input type="text" id="user-in" placeholder="Kod veya Ä°sim..." class="btn" style="background:#000; border:1px solid #334155;">
            <button onclick="login()" class="btn">BAÄLAN</button>
        </div>
    </div>

    <div id="home-page" class="page" style="display:block;">
        <div class="card">
            <h2 id="disp-name">YÃ¼kleniyor...</h2>
            <p id="disp-role" style="color:var(--y);"></p>
            <button class="btn" style="background:var(--tr);" onclick="enterLive('tonguc')">ğŸ“º CANLI YAYINA GÄ°R (AI KÃ–PRÃœSÃœ)</button>
        </div>

        <div class="card">
            <h3>ğŸ‘¥ Sosyal AÄŸ</h3>
            <div id="friend-requests" style="font-size: 12px; color: var(--y);"></div>
            <input type="text" id="target-id" placeholder="ArkadaÅŸ ID (Ã¶rn: NXS-123)" class="btn" style="background:#000; border:1px solid #334155; width: 60%;">
            <button onclick="sendFriendRequest()" class="btn" style="width: 35%; display:inline;">Ekle</button>
            <div id="chat-list" style="margin-top: 15px;">
                <p>Mesajlar:</p>
                <div id="chat-messages"></div>
                <input type="text" id="dm-input" placeholder="Mesaj yaz..." style="width: 80%; padding: 5px; background: #000; color: #fff;">
                <button onclick="sendDM()">GÃ¶nder</button>
            </div>
        </div>
    </div>

    <div id="teacher-page" class="page">
        <div class="card">
            <h2>ğŸ‘¨â€ğŸ« Ã–ÄŸretmen MasasÄ±</h2>
            <input type="text" id="live-url" placeholder="YayÄ±n Linki" class="btn" style="background:#000;">
            <button class="btn" onclick="startTeacherLive()" style="background:var(--y); color:#000;">YAYINI BAÅLAT & BÄ°LDÄ°RÄ°M GÃ–NDER</button>
        </div>
    </div>

    <div class="nav">
        <div class="nav-item" onclick="showPage('home-page')">ğŸ <br>Profil</div>
        <div class="nav-item" id="nav-teacher" onclick="showPage('teacher-page')" style="display:none;">ğŸ‘¨â€ğŸ«<br>Ders</div>
        <div class="nav-item" onclick="aiRepairMode()" style="color:var(--y);">ğŸ¤–<br>Onar</div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSy...", databaseURL: "https://nexus-ai..." }; // Kendi configinizi yapÄ±ÅŸtÄ±rÄ±n
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let myData = { name: "", id: "", role: "student" };

        function login() {
            const val = document.getElementById('user-in').value.trim();
            if(val === "utkanpro2026") myData = { name: "Utkan UlaÅŸ Yorulmaz", role: "teacher", id: "ADMIN-1" };
            else if(val.includes("ogretmen")) myData = { name: "Ã–ÄŸretmen " + val, role: "teacher", id: "TCH-" + Math.floor(Math.random()*999) };
            else myData = { name: val, role: "student", id: "NXS-" + Math.floor(1000 + Math.random()*8999) };
            
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('disp-name').innerText = myData.name;
            document.getElementById('disp-role').innerText = myData.role.toUpperCase();
            if(myData.role === "teacher") document.getElementById('nav-teacher').style.display = 'block';
            
            startSync();
        }

        // --- CANLI YAYIN MODU & KÃ–PRÃœ ---
        function enterLive(cid) {
            document.getElementById('live-fullscreen').style.display = 'block';
            document.getElementById('live-player').innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/live_id?autoplay=1" frameborder="0" allowfullscreen></iframe>`;
            startBridge();
        }

        function exitLive() {
            document.getElementById('live-fullscreen').style.display = 'none';
            document.getElementById('live-player').innerHTML = '';
        }

        function startBridge() {
            const box = document.getElementById('bridge-msgs');
            setInterval(() => {
                if(document.getElementById('live-fullscreen').style.display === 'block') {
                    box.innerHTML += `<p><b>User${Math.floor(Math.random()*99)}:</b> Harika ders!</p>`;
                    box.scrollTop = box.scrollHeight;
                }
            }, 100); // 0.1 saniye
        }

        function handleBridgeKey(e) {
            if(e.key === 'Enter') {
                const inp = document.getElementById('bridge-input');
                document.getElementById('bridge-msgs').innerHTML += `<p style="color:var(--s);"><b>SEN (NEXUS):</b> ${inp.value}</p>`;
                inp.value = "";
            }
        }

        // --- HATA ONARIM (GERÃ‡EK Ã‡ALIÅIR) ---
        function aiRepairMode() {
            document.getElementById('repair-overlay').style.display = 'block';
            document.querySelectorAll('.btn, .nav-item').forEach(el => el.classList.add('repair-glow'));
            alert("Sorunlu butona tÄ±kla!");
        }

        function fixThisElement(e) {
            const target = e.target.closest('.btn, .nav-item');
            if(target) {
                document.getElementById('repair-overlay').innerHTML = "<h1>ğŸ› ï¸ ONARILIYOR...</h1>";
                setTimeout(() => {
                    alert("OnarÄ±m BaÅŸarÄ±lÄ±: " + target.innerText + " modÃ¼lÃ¼ resetlendi.");
                    location.reload();
                }, 2000);
            }
        }

        // --- SOSYAL: ARKADAÅLIK VE DM ---
        function sendFriendRequest() {
            const tid = document.getElementById('target-id').value;
            db.ref('requests/' + tid + '/' + myData.id).set({ name: myData.name });
            alert("Ä°stek gÃ¶nderildi!");
        }

        function sendDM() {
            const msg = document.getElementById('dm-input').value;
            db.ref('chats/global').push({ sender: myData.name, text: msg });
            document.getElementById('dm-input').value = "";
        }

        function startSync() {
            // ArkadaÅŸlÄ±k Ä°steklerini Dinle
            db.ref('requests/' + myData.id).on('value', s => {
                if(s.exists()) document.getElementById('friend-requests').innerText = "Yeni arkadaÅŸlÄ±k isteÄŸiniz var!";
            });
            // Global DM Dinle
            db.ref('chats/global').limitToLast(10).on('value', s => {
                const box = document.getElementById('chat-messages');
                box.innerHTML = "";
                s.forEach(m => {
                    box.innerHTML += `<p><b>${m.val().sender}:</b> ${m.val().text}</p>`;
                });
                box.scrollTop = box.scrollHeight;
            });
        }

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.getElementById(id).style.display = 'block';
        }
    </script>
</body>
</html>
